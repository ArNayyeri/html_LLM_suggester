# html_LLM_suggester

یک تحلیلگر هوشمند فرم‌های وب و پیشنهاددهنده ورودی با استفاده از مدل‌های زبانی بزرگ (LLM).

## نمای کلی
این پروژه یک سرور بک‌اند مبتنی بر Flask و یک افزونه مرورگر ارائه می‌دهد تا:
- عکس‌های HTML/CSS و رویدادهای کاربر را از صفحات وب ضبط کند.
- فرم‌های وب را با استفاده از LLM‌ها تحلیل کند.
- مقادیر ورودی معتبر و محدوده‌ها را برای فیلدهای فرم، به زبان فارسی، بر اساس ساختار HTML پیشنهاد دهد.
- پیشنهادات را ذخیره و برای آزمایش یا خودکارسازی بیشتر به‌روزرسانی کند.

## ویژگی‌ها
- **استخراج فیلدهای فرم:** به‌طور خودکار فیلدهای `<input>`، `<textarea>` و `<select>` را از HTML شناسایی می‌کند.
- **پیشنهادات مبتنی بر LLM:** از LLM‌ها برای استنباط نوع فیلدها، قوانین اعتبارسنجی و تولید مقادیر تست واقعی استفاده می‌کند.
- **ضبط عکس‌ها:** HTML، CSS و رویدادهای کاربر را برای آزمایش قابل بازتولید ضبط می‌کند.
- **تولید تست Katalon:** رویدادهای ضبط‌شده کاربر را به اسکریپت‌های تست Katalon Studio با زمان‌های انتظار مناسب بین اقدامات تبدیل می‌کند.
- **رابط کاربری بهبود تست با هوش مصنوعی:** رابط تعاملی برای بهبود تست‌های تولیدشده Katalon با کمک LLM.
- **تاریخچه گفتگو:** زمینه مکالمه را برای تعاملات بهتر با هوش مصنوعی هنگام بهبود تست‌ها حفظ می‌کند.
- **نقاط پایانی API:**
  - `/snapshot` — ذخیره عکس صفحه فعلی.
  - `/events` — ذخیره لیستی از رویدادهای ضبط‌شده کاربر و تولید اسکریپت‌های تست Katalon.
  - `/suggest_inputs` — تحلیل HTML و بازگرداندن مقادیر ورودی پیشنهادی به صورت JSON.
  - `/update_input_suggestion` — به‌روزرسانی پیشنهادات فیلد و دریافت مثال‌های جدید از LLM.
- **افزونه مرورگر:** (در `my_recorder_extension/`) برای ضبط داده‌های صفحه و ارسال به بک‌اند.

## شروع به کار

### پیش‌نیازها
- Python 3.8+
- [Ollama](https://ollama.com/) (برای LLM محلی) یا کلید API OpenRouter
- Node.js (برای توسعه افزونه مرورگر، اختیاری)

### نصب
می‌توانید از **یکی** از روش‌های زیر استفاده کنید:

#### 1. کلون و اجرای کد پایتون
1. **کلون کردن مخزن:**
   ```sh
   git clone https://github.com/yourusername/html_LLM_suggester.git
   cd html_LLM_suggester
   ```
2. **نصب وابستگی‌های پایتون:**
   ```sh
   pip install -r requirements.txt
   ```
   وابستگی‌های کلیدی شامل:
   - `flask`, `flask-cors` — چارچوب سرور وب
   - `pydantic`, `bs4`, `beautifulsoup4` — تجزیه و اعتبارسنجی داده‌ها
   - `openai`, `ollama` — یکپارچه‌سازی LLM
   - `tiktoken` — شمارش توکن برای LLM‌ها
   - `deep-translator` — خدمات ترجمه
   - ماژول‌های داخلی پایتون: `tkinter` (رابط کاربری گرافیکی)، `threading`، `webbrowser`
3. **(اختیاری) تنظیم Ollama یا دریافت کلید API OpenRouter.**
4. **اجرای سرور:**
   ```sh
   python recorder_server.py
   ```
   از شما خواسته می‌شود بین محلی (Ollama) یا API (OpenRouter) انتخاب کنید.

#### 2. استفاده از آخرین نسخه
- آخرین نسخه پیش‌ساخته را از [صفحه نسخه‌ها](https://github.com/ArNayyeri/html_LLM_suggester/releases) این مخزن دانلود کنید.
- فایل‌های اجرایی یا ارائه‌شده را طبق یادداشت‌های نسخه استخراج و اجرا کنید.

### استفاده از افزونه مرورگر
- پوشه `my_recorder_extension/` را برای افزونه Chrome جهت ضبط داده‌های صفحه مشاهده کنید.
- آن را در Chrome از طریق `chrome://extensions` > "بارگذاری بدون بسته‌بندی" بارگذاری کنید.

## تولید تست Katalon

این ابزار به‌طور خودکار رویدادهای ضبط‌شده کاربر را به اسکریپت‌های تست Katalon Studio با ویژگی‌های زیر تبدیل می‌کند:

### ویژگی‌های کلیدی
- **محاسبه زمان انتظار هوشمند:** زمان‌های انتظار واقعی بین اقدامات را بر اساس زمان‌بندی واقعی کاربر اضافه می‌کند، به‌جز زمان پردازش افزونه مرورگر.
- **نگاشت نوع رویداد:** رویدادهای مختلف کاربر (کلیک‌ها، تغییرات ورودی، ارسال فرم‌ها) را به دستورات مناسب Katalon تبدیل می‌کند.
- **بهبود با هوش مصنوعی:** پس از تولید تست‌ها، یک رابط کاربری تعاملی برای بهینه‌سازی تست با کمک LLM باز می‌شود.

### ساختار تست تولیدشده
این ابزار اسکریپت‌های تست Katalon را با:
- دستورات `WebUI.delay()` برای زمان‌بندی واقعی
- `WebUI.click()` برای تعاملات کاربر
- `WebUI.setText()` برای تعاملات فیلد ورودی
- `WebUI.submit()` برای ارسال فرم‌ها
- انتخاب‌کننده‌های عنصر مناسب بر اساس رویدادهای ضبط‌شده ایجاد می‌کند.

### رابط کاربری بهبود تست با هوش مصنوعی
پس از پردازش رویدادهای کاربر توسط نقطه پایانی `/events`، یک رابط کاربری تعاملی به‌طور خودکار باز می‌شود که شامل:

#### رابط دو تب:
1. **تب تست فعلی:**
   - اسکریپت تست Katalon تولیدشده را نمایش می‌دهد
   - امکان ویرایش دستی و ذخیره را فراهم می‌کند
   - تست را در یک منطقه متنی قابل اسکرول نمایش می‌دهد

2. **تب دستیار هوش مصنوعی:**
   - رابط چت تعاملی با LLM
   - درک زمینه‌ای از تست شما
   - تاریخچه گفتگو را برای مکالمات بهتر حفظ می‌کند
   - از خدمات محلی (Ollama) و API (OpenRouter) پشتیبانی می‌کند

#### اقدامات موجود:
- **درخواست بهبود از هوش مصنوعی:** دریافت پیشنهادات برای بهینه‌سازی تست، مدیریت خطا یا اعتبارسنجی‌های اضافی
- **تولید مجدد تست:** درخواست از هوش مصنوعی برای بازنویسی کامل تست با بهبودها
- **ذخیره تست:** ذخیره تست فعلی در یک فایل
- **پاک کردن چت:** بازنشانی تاریخچه مکالمه
- **باز کردن در مرورگر:** مشاهده عکس صفحه اصلی

#### نکات استفاده:
- سوالات خاصی مانند "چگونه می‌توانم این تست را قوی‌تر کنم؟" بپرسید
- درخواست افزودنی‌هایی مانند "افزودن اعتبارسنجی‌ها برای تأیید موفقیت ارسال فرم"
- کمک بگیرید با "چه اعتبارسنجی‌هایی باید به این تست اضافه کنم؟"

## نقاط پایانی API
- `POST /snapshot` — ذخیره داده‌های HTML، CSS و رویداد.
- `POST /events` — ذخیره لیستی از رویدادهای کاربر، تولید اسکریپت‌های تست Katalon با زمان‌های انتظار مناسب، و راه‌اندازی رابط کاربری بهبود تست با هوش مصنوعی.
- `POST /suggest_inputs` — تحلیل HTML و بازگرداندن پیشنهادات ورودی به صورت JSON.
- `POST /update_input_suggestion` — به‌روزرسانی محدوده/مثال‌های یک فیلد و دریافت مثال‌های جدید تولیدشده توسط LLM.

## خروجی نمونه

### پیشنهادات ورودی
یک پاسخ معمولی از `/suggest_inputs`:
```json
[
  {
    "name": "نام پروژه",
    "id": "input-209",
    "type": "text",
    "range": "حداکثر 255 کاراکتر",
    "examples": [
      "پروژه نمونه 1",
      "پروژه نمونه 2"
    ]
  },
  ...
]
```

### تست تولیدشده Katalon
نمونه‌ای از یک اسکریپت تست Katalon تولیدشده از رویدادهای ضبط‌شده:

| خط | دستور | توضیحات | هدف | مقدار |
|------|---------|-------------|--------|-------|
| 1 | openBrowser | یک مرورگر جدید باز می‌کند | | |
| 2 | navigateToUrl | به URL مشخص‌شده می‌رود | https://example.com/form | |
| 3 | maximizeWindow | پنجره مرورگر را بزرگ می‌کند | | |
| 4 | delay | برای 2 ثانیه منتظر می‌ماند | | 2 |
| 5 | click | روی فیلد ورودی نام کلیک می‌کند | Page_form/input_name | |
| 6 | delay | برای 1 ثانیه منتظر می‌ماند | | 1 |
| 7 | setText | متن را در فیلد نام وارد می‌کند | Page_form/input_name | John Doe |
| 8 | delay | برای 3 ثانیه منتظر می‌ماند | | 3 |
| 9 | click | روی دکمه ارسال کلیک می‌کند | Page_form/button_submit | |
| 10 | delay | برای 2 ثانیه منتظر می‌ماند | | 2 |
| 11 | submit | فرم اصلی را ارسال می‌کند | Page_form/form_main | |
| 12 | closeBrowser | مرورگر را می‌بندد | | |

## ساختار پوشه
- `recorder_server.py` — بک‌اند اصلی Flask با تولید تست Katalon و رابط کاربری هوش مصنوعی.
- `my_recorder_extension/` — افزونه Chrome برای ضبط داده‌های صفحه وب.
- `snapshots/` — HTML/CSS/رویدادهای ذخیره‌شده، پیشنهادات LLM و اسکریپت‌های تست Katalon تولیدشده.
  - `run_*/` — جلسات ضبط جداگانه
  - `run_*/events.json` — رویدادهای ضبط‌شده کاربر
  - `run_*/katalon_test.html` — اسکریپت تست Katalon تولیدشده
  - `run_*/page_snapshot.html` — HTML صفحه ضبط‌شده

## تقدیر و تشکر
- [Ollama](https://ollama.com/)
- [OpenRouter](https://openrouter.ai/)
- [OpenAI Python SDK](https://github.com/openai/openai-python)
